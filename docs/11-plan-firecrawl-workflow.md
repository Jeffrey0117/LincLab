# Plan 10: Firecrawl çˆ¬èŸ²å·¥ä½œæµç¨‹

## æ¦‚è¿°

å»ºç«‹ä¸€å€‹çˆ¬èŸ²å·¥ä½œæµç¨‹é é¢ï¼Œç”¨æ–¼ï¼š
1. è¼¸å…¥æ–‡ç«  URL
2. ä½¿ç”¨ Firecrawl API çˆ¬å–æ–‡ç« å…§å®¹
3. æ•´ç†ä¸¦é è¦½æ–‡ç« å…§å®¹
4. å»ºç«‹åˆ†æ½¤å¡ç‰‡é€£çµ
5. å°å‡ºè³‡æ–™åˆ° Google Sheetï¼ˆä¾› Make.com ä¸²æ¥ï¼‰

---

## æŠ€è¡“è¦æ ¼

### Firecrawl API
```typescript
import Firecrawl from '@mendable/firecrawl-js';

const firecrawl = new Firecrawl({
  apiKey: process.env.FIRECRAWL_API_KEY
});

const doc = await firecrawl.scrape(url, {
  formats: ['markdown', 'html']
});
```

**API Key**: `fc-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` (set via `FIRECRAWL_API_KEY` env var)

---

## å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¼¸å…¥ URL   â”‚ -> â”‚ Firecrawl    â”‚ -> â”‚  å…§å®¹æ•´ç†    â”‚ -> â”‚ å»ºç«‹å¡ç‰‡    â”‚
â”‚  (æ–‡ç« é€£çµ) â”‚    â”‚  çˆ¬å–å…§å®¹    â”‚    â”‚  é è¦½ç¢ºèª    â”‚    â”‚ (åˆ†æ½¤é€£çµ)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                  â”‚
                                                                  v
                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                          â”‚ å°å‡º Sheet  â”‚
                                                          â”‚ (Webhook)   â”‚
                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é é¢è¨­è¨ˆ

### è·¯ç”±
```
/dashboard/scraper
```

### UI å…ƒä»¶

#### Step 1: URL è¼¸å…¥
```typescript
interface ScraperInput {
  url: string;           // è¦çˆ¬å–çš„æ–‡ç«  URL
  affiliateUrl: string;  // è¦çš®åˆ†æ½¤é€£çµ
}
```

#### Step 2: çˆ¬å–çµæœé è¦½
- æ¨™é¡Œ (å¾ metadata æˆ– h1 æå–)
- æè¿° (å¾ meta description æˆ–é¦–æ®µ)
- å°é¢åœ– (å¾ og:image)
- Markdown å…§å®¹é è¦½
- HTML å…§å®¹é è¦½

#### Step 3: å¡ç‰‡è¨­å®š
- é¸æ“‡æ¨¡æ¿é¡å‹ (external_link / article / beauty)
- ç·¨è¼¯æ¨™é¡Œ/æè¿°
- è¨­å®šç­–ç•¥ (å¯é¸)

#### Step 4: å»ºç«‹ & å°å‡º
- å»ºç«‹é€£çµæŒ‰éˆ•
- å°å‡ºåˆ° Google Sheet æŒ‰éˆ•

---

## API ç«¯é»

### 1. çˆ¬å–æ–‡ç« 
```typescript
// POST /api/scraper/crawl
interface CrawlRequest {
  url: string;
}

interface CrawlResponse {
  success: boolean;
  data: {
    markdown: string;
    html: string;
    metadata: {
      title?: string;
      description?: string;
      ogImage?: string;
      // ...å…¶ä»– metadata
    };
  };
}
```

### 2. å»ºç«‹å¡ç‰‡é€£çµ
```typescript
// POST /api/scraper/create-link
interface CreateLinkRequest {
  targetUrl: string;      // åŸæ–‡ URL
  affiliateUrl: string;   // è¦çš®åˆ†æ½¤é€£çµ
  title: string;
  description: string;
  ogImage: string;
  templateType: string;
  content?: string;       // Markdown å…§å®¹ (å¯é¸)
}

interface CreateLinkResponse {
  success: boolean;
  shortCode: string;
  fullUrl: string;
}
```

### 3. å°å‡ºåˆ° Google Sheet (Webhook)
```typescript
// POST /api/scraper/export
interface ExportRequest {
  shortCode: string;
  affiliateUrl: string;
  title: string;
  description: string;
  targetUrl: string;
  createdAt: string;
}

// æˆ–è€…æä¾› GET ç«¯é»çµ¦ Make.com æ‹‰å–
// GET /api/export/links?status=pending
```

---

## è³‡æ–™åº«æ“´å±•

### æ–°å¢æ¬„ä½åˆ° links è¡¨ (å¯é¸)
```sql
ALTER TABLE links ADD COLUMN export_status text DEFAULT 'pending';
-- 'pending' | 'exported' | 'failed'

ALTER TABLE links ADD COLUMN exported_at timestamp with time zone;
```

---

## ç’°å¢ƒè®Šæ•¸

```env
# .env.local
FIRECRAWL_API_KEY=your-firecrawl-api-key

# Make.com Webhook URL (ä¹‹å¾Œè¨­å®š)
MAKE_WEBHOOK_URL=https://hook.make.com/xxxxx
```

---

## å¯¦ä½œéšæ®µ

### Phase 1: åŸºç¤çˆ¬èŸ²åŠŸèƒ½
- [ ] å®‰è£ @mendable/firecrawl-js
- [ ] å»ºç«‹ `/api/scraper/crawl` ç«¯é»
- [ ] å»ºç«‹çˆ¬èŸ²é é¢ UI (`/dashboard/scraper`)
- [ ] URL è¼¸å…¥è¡¨å–®
- [ ] é¡¯ç¤ºçˆ¬å–çµæœé è¦½

### Phase 2: å¡ç‰‡å»ºç«‹æ•´åˆ
- [ ] æ•´åˆç¾æœ‰é€£çµå»ºç«‹é‚è¼¯
- [ ] è‡ªå‹•å¡«å…¥çˆ¬å–çš„ metadata
- [ ] æ¨¡æ¿é¸æ“‡
- [ ] å»ºç«‹é€£çµä¸¦é¡¯ç¤ºçŸ­ç¶²å€

### Phase 3: Google Sheet å°å‡º
- [ ] å»ºç«‹ `/api/export/links` ç«¯é»
- [ ] æ”¯æ´ Webhook æ¨é€åˆ° Make.com
- [ ] æˆ–æ”¯æ´ Make.com HTTP æ¨¡çµ„æ‹‰å–
- [ ] åŒ¯å‡ºç‹€æ…‹è¿½è¹¤

### Phase 4: æ‰¹æ¬¡è™•ç† (é€²éš)
- [ ] æ”¯æ´å¤šå€‹ URL æ‰¹æ¬¡çˆ¬å–
- [ ] ä½‡åˆ—è™•ç†
- [ ] æ‰¹æ¬¡å°å‡º

---

## é é¢ Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” æ–‡ç« çˆ¬èŸ²å·¥å…·                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  æ–‡ç«  URL                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ https://example.com/article/123             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚  è¦çš®åˆ†æ½¤é€£çµ                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ https://shope.ee/xxxxx                      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                         â”‚
â”‚  [çˆ¬å–æ–‡ç« ]                                             â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“„ çˆ¬å–çµæœ                                            â”‚
â”‚                                                         â”‚
â”‚  æ¨™é¡Œ: 10æ¬¾è¶…å¥½ç”¨çš„ä¿é¤Šå“æ¨è–¦                            â”‚
â”‚  æè¿°: é€™ç¯‡æ–‡ç« æ•´ç†äº†10æ¬¾...                            â”‚
â”‚  å°é¢: [åœ–ç‰‡é è¦½]                                       â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€ Markdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ # 10æ¬¾è¶…å¥½ç”¨çš„ä¿é¤Šå“æ¨è–¦                    â”‚         â”‚
â”‚  â”‚ ...                                        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¨ å¡ç‰‡è¨­å®š                                            â”‚
â”‚                                                         â”‚
â”‚  æ¨¡æ¿é¡å‹: [external_link â–¼]                            â”‚
â”‚                                                         â”‚
â”‚  [å»ºç«‹åˆ†æ½¤å¡ç‰‡]                                         â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… å»ºç«‹æˆåŠŸ                                            â”‚
â”‚                                                         â”‚
â”‚  çŸ­ç¶²å€: https://linclab.vercel.app/abc123              â”‚
â”‚                                                         â”‚
â”‚  [è¤‡è£½é€£çµ] [å°å‡ºåˆ° Google Sheet]                       â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Make.com æ•´åˆæ–¹å¼

### æ–¹å¼ A: Webhook æ¨é€ (æ¨è–¦)
1. åœ¨ Make.com å»ºç«‹ Webhook trigger
2. è¤‡è£½ Webhook URL åˆ°ç’°å¢ƒè®Šæ•¸
3. é»æ“Šã€Œå°å‡ºã€æ™‚ï¼ŒPOST è³‡æ–™åˆ° Webhook
4. Make.com æ¥æ”¶å¾Œå¯«å…¥ Google Sheet

### æ–¹å¼ B: HTTP å®šæ™‚æ‹‰å–
1. å»ºç«‹ GET /api/export/links ç«¯é»
2. Make.com è¨­å®šæ’ç¨‹ (æ¯å°æ™‚/æ¯å¤©)
3. HTTP æ¨¡çµ„å‘¼å« API å–å¾—å¾…åŒ¯å‡ºè³‡æ–™
4. å¯«å…¥ Google Sheet å¾Œæ›´æ–°ç‹€æ…‹

---

## å°å‡ºè³‡æ–™æ ¼å¼

```json
{
  "shortCode": "abc123",
  "fullUrl": "https://linclab.vercel.app/abc123",
  "affiliateUrl": "https://shope.ee/xxxxx",
  "title": "10æ¬¾è¶…å¥½ç”¨çš„ä¿é¤Šå“æ¨è–¦",
  "description": "é€™ç¯‡æ–‡ç« æ•´ç†äº†10æ¬¾...",
  "targetUrl": "https://example.com/article/123",
  "ogImage": "https://...",
  "createdAt": "2025-01-18T10:30:00Z"
}
```

---

## æ³¨æ„äº‹é …

1. **Firecrawl API é™åˆ¶**: ç¢ºèª API é…é¡å’Œé€Ÿç‡é™åˆ¶
2. **å…§å®¹éæ¿¾**: å¯èƒ½éœ€è¦æ¸…ç†çˆ¬å–çš„ HTML/Markdown
3. **éŒ¯èª¤è™•ç†**: è™•ç†çˆ¬å–å¤±æ•—ã€è¶…æ™‚ç­‰æƒ…æ³
4. **å®‰å…¨æ€§**: API Key ä¸è¦æš´éœ²åœ¨å‰ç«¯

---

## ä¸‹ä¸€æ­¥

ç¢ºèªæ­¤è¦åŠƒå¾Œï¼Œé–‹å§‹ Phase 1 å¯¦ä½œï¼š
1. å®‰è£ Firecrawl SDK
2. å»ºç«‹çˆ¬èŸ² API
3. å»ºç«‹çˆ¬èŸ²é é¢ UI
